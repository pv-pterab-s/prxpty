#!/usr/bin/env lsc
assert = require 'assert'

export msg2log = (msg, time) ->
  assert (typeof msg) is 'string'

  now2base64 = ->
    A = new BigUint64Array(1)
    A[0] = time or process.hrtime.bigint()
    B = new Uint8Array(A.buffer)
    Buffer.from(B).toString('base64')

  msg2base64 = (msg) ->
    Buffer.from(msg).toString('base64')

  now2base64! + msg2base64 msg


export log2msg = (log) ->
  assert (typeof log) is 'string'

  base64ToNs = (base64) ->
    e = Buffer.from(base64, 'base64')
    a = new Uint8Array(e)
    (new BigUint64Array(a.buffer))[0]

  base64ToBuffer = (base64) ->
    Buffer.from(base64, 'base64')

  time: base64ToNs log.slice 0, 12
  msg: base64ToBuffer log.slice 12
