#!/bin/bash
set -e

TEMP=$(mktemp)
for I in {0..3} ; do
  echo $I
  sleep 1s
done | src/log.ls $TEMP

TEMP2=$(mktemp)
for I in {1..4} ; do
  sed -n ${I}p $TEMP
  sleep 1s
done | DBG=stdin src/filter0.ls | src/log.ls $TEMP2


function log2msgs {
  cat $1 | sed 's/^.\{12\}//g'
}

cmp <(log2msgs $TEMP) <(log2msgs $TEMP2)
