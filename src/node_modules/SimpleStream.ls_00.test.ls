#!/usr/bin/env lsc
assert = require 'assert'
SimpleStream = require 'SimpleStream'
{M, expect} = require 'util.ls'

S = new SimpleStream

# rest should succeed
stopListening = expect S, S.once, 'data', ['hey']
S.write Buffer.from 'hey'
stopListening()
S.write Buffer.from 'broken?'  # no error means .off worked

stopListening expect S, S.on, 'data', ['hey', 'there']
S.write Buffer.from 'hey'
S.write Buffer.from 'theree'
stopListening()
S.write Buffer.from 'blah'  # no error means .off worked

failIfFired = (d) -> M "never emit:"; M d; assert false
S.on 'data', failIfFired
S.write Buffer.from ''
S.off 'data', failIfFired
S.write Buffer.from 'should not fail'
