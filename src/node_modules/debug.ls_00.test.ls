#!/usr/bin/env lsc
assert = require 'assert'
process.env.DBG = 'stdin'
debug = require 'debug.ls'

M = (s) -> console.log s; s
E = (s) -> console.error s; s

# check internal debug utility

# . cat-buffers
A = new Buffer.from('hey')
B = new Buffer.from(' there')
assert (debug.cat-buffers A, B).toString() is 'hey there'

# . split-buffer
A = new Buffer.from('hey there fewl')
V = debug.split-buffer A, A[3]
assert V[0].toString! is 'hey'
assert V[1].toString! is 'there'
assert V[2].toString! is 'fewl'

A = new Buffer.from('hey')
V = debug.split-buffer A, A[3]
assert V[0].toString! is 'hey'

A = new Buffer.from('')
V = debug.split-buffer A, A[3]
assert V.length is 0


# consume-logs-buffer
assert debug.get-buffer!.length is 0
A = new Buffer 'hey\nthere\nfewl'
msgs = debug.consume-logs-buffer A
assert msgs[0].toString! is 'hey'
assert msgs[1].toString! is 'there'
assert debug.get-buffer!.toString! is 'fewl'

A = new Buffer '\n'
msgs = debug.consume-logs-buffer A
assert msgs[0].toString! is 'fewl'
assert debug.get-buffer!.length is 0

A = new Buffer ''
msgs = debug.consume-logs-buffer A
assert msgs.length is 0
assert debug.get-buffer!.length is 0
